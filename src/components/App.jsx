import React, { Component } from "react";
import Tabs from "./Tabs";
import Filter from "./Filter";
import Content from "./Content";
import "../App.css";
const { Client } = require("pg");

// console.log(process.env.DATABASE_URL);

const connectionString =
  "postgres://fbqxuhwrghmnfl:a82c2097ff66fac1471e7fc04a49aa7a2470fd979919d2b4540d842cb8ce1e14@ec2-54-235-163-246.compute-1.amazonaws.com:5432/d6biij9vvfm45g";

const client = new Client({
  connectionString: connectionString,
  ssl: true
});

client.connect();

// client.query(
//   "SELECT table_schema,table_name FROM information_schema.tables;",
//   (err, res) => {
//     if (err) throw err;
//     for (let row of res.rows) {
//       console.log(JSON.stringify(row));
//     }
//     client.end();
//   }
// );

class App extends Component {
  state = {
    data: {
      sessions_data: [],
      applications_data: [],
      target_industries: [],
      top_malware: []
    },
    span: 30
  };

  componentDidMount = () => {
    // Getting data from MySql DB
    for (let db in this.state.data) {
      client.query(`SELECT * FROM ${db}`, (err, res) => {
        if (err) throw err;
        for (let row of res.rows) {
          console.log(JSON.stringify(row));
        }
      });
      client.end();

      // fetch(`http://localhost:3001/api/getdata/${db}`)
      //   .then(response => response.json())
      //   .then(table => {
      //     const data = { ...this.state.data };
      //     data[db] = table;
      //     this.setState({ data });
      //   })
      //   .catch(err => console.log(err));
    }
  };

  // Handling user clicks
  handleFilterChange = span => {
    this.setState({ span });
  };

  render() {
    return (
      <div className="App">
        <Tabs />
        <content filter={this.state.filter}>
          <Filter onClick={this.handleFilterChange} span={this.state.span} />
          <Content data={this.state.data} span={this.state.span} />
        </content>
      </div>
    );
  }
}

export default App;
