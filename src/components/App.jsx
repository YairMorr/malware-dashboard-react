import React, { Component } from "react";
import Tabs from "./Tabs";
import Filter from "./Filter";
import Content from "./Content";

import "../App.css";

class App extends Component {
  state = {
    data: {
      sessions_data: [],
      applications_data: [],
      target_industries: [],
      top_malware: []
    },
    span: 30
  };

  componentDidMount = () => {
    // Getting data from MySql DB
    for (let db in this.state.data) {
      fetch(`http://localhost:3001/api/getdata/${db}`)
        .then(response => response.json())
        .then(table => {
          const data = { ...this.state.data };
          data[db] = table;
          this.setState({ data });
        })
        .catch(err => console.log(err));
    }
  };

  // Handling user clicks
  handleFilterChange = span => {
    this.setState({ span });
  };

  render() {
    return (
      <div className="App">
        <Tabs />
        <content filter={this.state.filter}>
          <Filter onClick={this.handleFilterChange} span={this.state.span} />
          <Content data={this.state.data} span={this.state.span} />
        </content>
      </div>
    );
  }
}

export default App;
