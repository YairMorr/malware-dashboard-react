import React from "react";
import YAxis from "./YAxis";
import Gridlines from "./Gridlines";
import Plot from "./Plot";

const Chart = props => {
  const { data } = props;

  // Generates Y axis values based on highest value from database
  function generateValues(data) {
    let yAxis = ["0"];
    // Getting highest value in database
    if (data.length > 0) {
      let high = getHighestValue(data);

      const digitNum = high.toString().length; // Getting number of digits in highest number
      // const factor = Math.pow(10, digitNum);
      const factor = digitNum;
      // high = Math.round(high / factor) * factor; // Getting the highest value for Y axis

      // Generating Y axis values
      for (let count = 1; count <= factor; count++) {
        let value = (high / factor) * count;
        value = String(Math.floor(value));

        if (value.length === 7) yAxis.push(value.substring(0, 4) + "m");
        if (value.length === 6) yAxis.push(value.substring(0, 3) + "k");
        if (value.length === 5) yAxis.push(value.substring(0, 2) + "k");
        if (value.length === 4) yAxis.push(value.substring(0, 2) + "a");
      }
    }
    return yAxis.reverse();
  }

  function getHighestValue(data) {
    let high = 0;
    for (let item of data) {
      if (high < item.value) high = item.value;
    }

    return high;
  }

  return (
    <div className="graph-container">
      <YAxis data={generateValues(data)} />
      <Gridlines data={generateValues(data)} />
      <Plot
        data={data}
        chartMaxHeight={getHighestValue(data)}
        textRotation={props.textRotation}
      />
    </div>
  );
};

export default Chart;
